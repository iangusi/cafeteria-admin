<!-- Plantilla de lista de ventas: muestra tarjetas/bloques con la info solicitada -->
{% extends 'base.html' %}
{% block content %}
<h1>Ventas</h1>
<div class="ventas-grid">
  {% for venta in ventas %}
  <div class="venta-card card mb-3">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <div>
          <h5 class="card-title">{{ venta.titulo }}</h5>
          <p class="card-subtitle text-muted">{{ venta.fecha }}</p>
        </div>
        <div class="text-end">
          <span class="badge bg-secondary">{{ venta.get_estado_display }}</span>
        </div>
      </div>

      <div class="mt-2">
        <p><strong>Precio venta:</strong> ${{ venta.precio_total_cache }}</p>
        <p><strong>Costo:</strong> ${{ venta.costo_total_cache }}</p>
        <p><strong>Puntos usados:</strong> {{ venta.puntos_usados }}</p>
        <p><strong>Precio final:</strong> ${{ venta.precio_final }}</p>
      </div>

      <hr/>

      <div>
        <strong>Productos:</strong>
        <ul>
          {% for item in venta.items.all %}
            {% if item.producto %}
            <li>{{ item.producto.nombre }} x{{ item.cantidad }} — ${{ item.precio }} c/u</li>
            {% else %}
            <li>Producto x{{ item.cantidad }} — ${{ item.precio }} c/u</li>
            {% endif %}
          {% empty %}
            <li>No hay productos</li>
          {% endfor %}
        </ul>
      </div>

      <div class="mt-3 d-flex gap-2">
        {% if venta.estado == 'pendiente' %}
        <a href="{% url 'venta_edit' venta.pk %}" class="btn btn-sm btn-primary">Editar</a>
        <form method="post" action="{% url 'venta_cancel' venta.pk %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-danger">Cancelar</button>
        </form>
        <form method="post" action="{% url 'venta_finalize' venta.pk %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-success">Finalizar</button>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="pagination">
  {% if is_paginated %}
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}">Anterior</a>
    {% endif %}
    <span>Página {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}">Siguiente</a>
    {% endif %}
  {% endif %}
</div>
{% endblock %}